{%extends "./index.html"%} 

{%block titulo%} Shop {%endblock%}
{% load static %}

{%block head%}
<link rel="stylesheet" href="{%static 'css\styleShop.css' %}">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>

{%endblock%}

{%block conteudo%}


<body>
    <div class="nav container" >
        <a href="{% url 'ZOO_App:getProductsInCart'%}" class="logo"> Shopping </a>
        <i class="bx bx-shopping-bag"  id="shopping-icon"></i>
        <i class="bx bx-cart"  id="cart-icon"></i>
        <div class="cart">
            <h2 class="cart-title"> Shopping Cart</h2>
            <div class="cart-content">

                {%if all%}
                    {% for key, value in all.items %}
                    <div class="cart-box">
                        <!--<img src="" alt="" class="cart-image">--> 
                        <div class="detail-product">
                            <img src="static{{key.produto.imagem.url}}" alt="" style=" width: 50%; height: 50%;" class="product-cart-image">
                            <p class="product-cart-price">{{key.produto.preco}} €</p>
                            <input type="number" value={{value.quantidade}} class="product-quantity">
                            <i class="bx bxs-trash-alt product-remove"></i>
                        </div>
                    </div>
                    {% endfor %}
                {% endif %}
                
                <div class="cart-total">
                    <h3 class="cart-total-title"> Total</h3>
                    <h3 class="cart-total-price"> </h3>
                    <button type="button" class="btn-checkout">Checkout</button>
                    <i class="bx bx-x"></i>
                </div>
            </div>
        </div>
    </div>

    <section class="shop container"> 
        <h2 class="section-title">Shop Products</h2>
        <div class="shop-content">
            
            {% for produto in product_list %}
                <a class="product-box" href="{% url 'ZOO_App:produto' produto.id%}">
                    <img src="static{{produto.imagem.url}}" alt="" class="product-image">
                    <h2 class="product-title">{{produto.designacao}}</h2>
                    <h4 class="product-price"> {{produto.preco}} € </h4>
                </a>
            {% endfor %} 
        </div>
    </section>

    <script>
        $(document).ready(function(){
            $("#cart-icon").click(function(){
                sum();
                $(".cart").toggle("slide");
            });   
        });

        function sum() {
            const prices = document.getElementsByClassName("product-cart-price");
            const quantities = document.getElementsByClassName("product-quantity");
            let sum=0;
            let aux="";
            for (let index = 0; index < prices.length; index++) {
                aux = prices[index].textContent.substring(0, prices[index].textContent.length-2);
                sum += parseFloat(aux) * parseFloat(quantities[index].value);  
            }
            //document.getElementsByClassName("cart-total-price")[0].value = sum;
            let string = sum.toString();
            let aux2 = string.split(".")
            string = aux2[0] + "." + aux2[1].substring(0,2) + " €";
            document.getElementsByClassName("cart-total-price")[0].textContent = string;
        }
    </script>
    {% endblock %}